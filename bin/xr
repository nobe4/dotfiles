#!/usr/bin/env bash

set -e

source "$DOTFILE_FOLDER/shell/utils.sh"

is_linux && (
	args=("$@")

	if [[ ${#args[@]} -gt 0 && ${args[0]} == "switch" ]]; then
		echo "'switch' detected, injecting '--install-bootloader'"
		args+=("--install-bootloader")
	fi

	sudo nixos-rebuild "${args[@]}"
	[[ -L ./result ]] && rm -f ./result
)

is_macos && (
	sudo darwin-rebuild switch
)
