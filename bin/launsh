#!/usr/bin/env bash
#
# Setup:
# 1. create an automator workflow that runs one of the following:
#
#  - Terminal.app
#    ```applescript
#    tell application "Terminal" to activate
#    tell application "Terminal" to do script "launsh 2>> "${HOME}/Library/Logs/launsh.log" ; exit"
#    ```
#
#  - Kitty
#    ```bash
#    source "${HOME}/.zprofile" && kitty launsh 2>> "${HOME}/Library/Logs/launsh.log"
#    ```
#
# 2. Settings > Keyboard > Shortcuts > Services > General > Set the service
#
# TODO:
#   - allow to pass a custom "list binaries" command

set -e

COMMANDS_PATH="${DOTFILE_FOLDER}/bin/commands"
PRIVATE_COMMANDS_PATH="${DOTFILE_FOLDER}/private/bin/commands"

LOG_FILE="${HOME}/Library/Logs/launsh.log"
BECOME_COMMAND="
	{} 2>> ${LOG_FILE} || \
		( \
			echo '{} failed' && \
			echo 'Look at ${LOG_FILE}' && \
			echo 'Press <CR> to exit... ' && \
			read -r \
		)
"

find "${COMMANDS_PATH}" "${PRIVATE_COMMANDS_PATH}" \
	-type f \
	-exec basename {} \; \
	| sort \
	| fzf \
		--preview="{} -h" \
		--bind="enter:become(${BECOME_COMMAND})"

